define(["dom","focusManager","events","globalize","layoutManager","playbackManager","itemHelper","listView","emby-scroller","emby-itemscontainer","css!./playqueue","paper-icon-button-light"],function(dom,focusManager,events,globalize,layoutManager,playbackManager,itemHelper,listView){"use strict";function OsdPlayQueue(options){var parent=(this.options=options).parent;!function(parent){parent.innerHTML='<div is="emby-scroller" class="flex flex-grow osdPlaylist-scroller osdPlaylist" data-mousewheel="true" data-horizontal="false" data-centerfocus="true"><div is="emby-itemscontainer" class="scrollSlider flex-grow flex-direction-column vertical-list itemsContainer osdPlaylistItemsContainer" data-skipplaycommands="true" data-dragreorder="true" data-virtualscrolllayout="vertical-grid"></div></div>',parent.classList.remove("hide")}(parent),this.playlistElement=parent.querySelector(".osdPlaylist"),this.itemsContainer=parent.querySelector(".itemsContainer"),this.itemsContainer.fetchData=function(query){return this.empty?Promise.resolve({Items:[],TotalRecordCount:0}):playbackManager.getPlaylist(query||{},this.currentPlayer)}.bind(this),this.itemsContainer.getListOptions=function(items){return{renderer:listView,options:{smallIcon:!0,action:"setplaylistindex",playAction:"setplaylistindex",enableUserDataButtons:!1,mediaInfo:!1,moreButton:!1,rightButtons:[{icon:"&#xE15C;",title:globalize.translate("Remove"),id:"remove"}],dragHandle:!layoutManager.tv,multiSelect:!1,playQueueIndicator:!0},virtualScrollLayout:"vertical-list"}}.bind(this),this.itemsContainer.scrollResizeObserver=!0,this.toggleIcon=parent.querySelector(".btnToggleOsdPlayQueue-icon"),this.itemsContainer.addEventListener("action-remove",function(e){playbackManager.removeFromPlaylist([e.detail.playlistItemId],this.currentPlayer)}.bind(this)),this.itemsContainer.addEventListener("itemdrop",function(e){var newIndex=e.detail.newIndex,playlistItemId=e.detail.playlistItemId;playbackManager.movePlaylistItem(playlistItemId,newIndex,this.currentPlayer)}.bind(this))}return OsdPlayQueue.prototype.scrollCurrentTrackToTop=function(){var itemsContainer,index=playbackManager.getCurrentPlaylistIndex(this.currentPlayer);-1===index||(itemsContainer=this.playlistElement.querySelector(".itemsContainer"))&&itemsContainer.scrollToIndex(index,{behavior:"instant"},!1)},OsdPlayQueue.prototype.setPausedState=function(paused){var elem=this.playlistElement.querySelector(".playlistIndexIndicatorImage");elem&&(paused?elem.classList.add("playlistIndexIndicatorImage-paused"):elem.classList.remove("playlistIndexIndicatorImage-paused"))},OsdPlayQueue.prototype.updatePlaylist=function(player,playlistItemId,playlistIndex,playlistLength){this.currentPlayer=player;var parent=this.options.parent;this.empty=!playlistLength,this.refreshItems(),1<playlistLength?parent.classList.remove("osdPlayQueue-singletrack"):parent.classList.add("osdPlayQueue-singletrack")},OsdPlayQueue.prototype.onPlaybackStopped=function(){this.empty=!0,this.refreshItems()},OsdPlayQueue.prototype.refreshItems=function(){this.itemsContainer.refreshItems?this.itemsContainer.refreshItems():setTimeout(this.refreshItems.bind(this),100)},OsdPlayQueue.prototype.onPlaylistItemMoved=function(player,e,info){this.itemsContainer.refreshItems()},OsdPlayQueue.prototype.onPlaylistItemRemoved=function(player,e,info){this.itemsContainer.refreshItems()},OsdPlayQueue.prototype.onInputCommand=function(e){return!1},OsdPlayQueue.prototype.pause=function(){this.itemsContainer.pause()},OsdPlayQueue.prototype.resume=function(options){return this.itemsContainer.resume(options)},OsdPlayQueue.prototype.destroy=function(){var parent,options=this.options;!options||(parent=options.parent)&&(parent.innerHTML="",parent.classList.add("hide")),this.options=null,this.currentPlayer=null,this.upNextTitleElement=null,this.itemsContainer=null,this.playlistElement=null,this.toggleIcon=null},OsdPlayQueue});