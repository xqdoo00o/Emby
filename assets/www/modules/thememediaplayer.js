define(["./emby-apiclient/events.js","./emby-apiclient/connectionmanager.js","./common/usersettings/usersettings.js","./common/playback/playbackmanager.js"],function(_events,_connectionmanager,_usersettings,_playbackmanager){var currentOwnerId;_events=babelHelpers.interopRequireDefault(_events),_connectionmanager=babelHelpers.interopRequireDefault(_connectionmanager),_usersettings=babelHelpers.interopRequireDefault(_usersettings),_playbackmanager=babelHelpers.interopRequireDefault(_playbackmanager);var currentPlayer;function playThemeMedia(items,ownerId){if(items.length){if(!currentOwnerId&&_playbackmanager.default.isPlaying())return;items.map(function(i){return i.Id}),_playbackmanager.default.play({items:items,fullscreen:!1,enableRemotePlayers:!1}).then(function(){currentOwnerId=ownerId})}else stopIfPlaying()}function stopIfPlaying(){currentOwnerId&&_playbackmanager.default.stop(),currentOwnerId=null}var excludeTypes=["CollectionFolder","UserView","Program","SeriesTimer","Person","TvChannel","Channel","User","Plugin","Device"];document.addEventListener("viewshow",function(e){currentPlayer&&!currentPlayer.isLocalPlayer||e.detail.supportsThemeMedia||playThemeMedia([],null)},!0),document.addEventListener("itemshow",function(e){var item;currentPlayer&&!currentPlayer.isLocalPlayer||(item=e.detail.item)&&item.ServerId&&function(item){var apiClient,enableThemeVideos;!item.CollectionType&&!excludeTypes.includes(item.Type)&&item.ServerId&&item.Id?(apiClient=_connectionmanager.default.getApiClient(item),enableThemeVideos=_usersettings.default.enableThemeVideos(),apiClient.getThemeMedia(item.Id,{UserId:apiClient.getCurrentUserId(),InheritFromParent:!0,EnableThemeSongs:_usersettings.default.enableThemeSongs(),EnableThemeVideos:enableThemeVideos}).then(function(themeMediaResult){var itemsResult=themeMediaResult.ThemeVideosResult.Items.length?themeMediaResult.ThemeVideosResult:themeMediaResult.ThemeSongsResult,ownerId=itemsResult.OwnerId;ownerId!==currentOwnerId&&playThemeMedia(itemsResult.Items,ownerId)})):stopIfPlaying()}(item)},!0),document.addEventListener("itemclear",function(e){currentPlayer&&!currentPlayer.isLocalPlayer||playThemeMedia([],null)},!0),_events.default.on(_playbackmanager.default,"playerchange",function(e,player){currentPlayer=player})});